<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>تسجيل دخول مستخدم</title>
  <style>
    body { font-family: Arial; padding: 20px; background: #f3f3f3; }
    .box { background: white; padding: 20px; width: 300px; margin: auto; border-radius: 10px; }
    input { width: 100%; padding: 10px; margin-top: 10px; }
    button { padding: 10px; width: 100%; margin-top: 20px; cursor: pointer; }
    #result { margin-top: 20px; padding: 10px; background: #eee; border-radius: 5px; }
  </style>
</head>

<body>

<div class="box">
  <h2>تسجيل دخول</h2>

  <input id="userId" placeholder="اكتب ID أو رقم المستخدم">
  <input id="password" type="password" placeholder="اكتب الرمز">

  <button onclick="login()">دخول</button>

  <div id="result"></div>
</div>

<script type="module">
  // Firebase imports
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
  import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-database.js";

  // Firebase config (من عندك)
  const firebaseConfig = {
    apiKey: "AIzaSyAKGrxv_GT3T3krYeYY5C-o7VmvLkG-gw0",
    authDomain: "cashapp-405b7.firebaseapp.com",
    databaseURL: "https://cashapp-405b7-default-rtdb.firebaseio.com",
    projectId: "cashapp-405b7",
    storageBucket: "cashapp-405b7.firebasestorage.app",
    messagingSenderId: "146496743526",
    appId: "1:146496743526:web:edc0318c7f3affa25465a7",
    measurementId: "G-NWMR38V1B9"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  // دالة تسجيل الدخول
  async function login() {
    const id = document.getElementById("userId").value.trim();
    const pass = document.getElementById("password").value.trim();
    const resultBox = document.getElementById("result");

    if (!id || !pass) {
      resultBox.innerHTML = "⚠️ يرجى ملء جميع الحقول";
      return;
    }

    // المسار في الداتابيس: users / ID
    const userRef = ref(db, "users/" + id);

    try {
      const snapshot = await get(userRef);

      if (!snapshot.exists()) {
        resultBox.innerHTML = "❌ اسم المستخدم أو الرمز غير صحيح";
        return;
      }

      const data = snapshot.val();

      // التحقق من الرمز (passwordhash)
      if (data.passwordhash !== pass) {
        resultBox.innerHTML = "❌ اسم المستخدم أو الرمز غير صحيح";
        return;
      }

      // عرض معلومات المستخدم
      resultBox.innerHTML = `
        ✔️ <b>اسم المستخدم:</b> ${data.name}<br>
        ✔️ <b>ID:</b> ${data.id}<br>
        ✔️ <b>الرصيد:</b> ${data.money}
      `;

    } catch (error) {
      resultBox.innerHTML = "حدث خطأ أثناء الاتصال بالداتابيس";
      console.error(error);
    }
  }
</script>

</body>
</html>
